name: dokploy
version: v0.2.0
description: "Dokploy provider for DevPod - Create and manage development machines via Dokploy"
icon: https://raw.githubusercontent.com/Dokploy/dokploy/refs/heads/canary/apps/dokploy/logo.png

options:
  DOKPLOY_SERVER_URL:
    description: "URL of your Dokploy server (e.g., https://your-dokploy.com)"
    required: true
  DOKPLOY_API_TOKEN:
    description: "API token for Dokploy authentication (generate from Settings > Profile > API/CLI)"
    required: true
    password: true
  DOKPLOY_PROJECT_NAME:
    description: "Dokploy project name for organizing workspaces"
    default: "devpod-workspaces"
  DOKPLOY_SERVER_ID:
    description: "Dokploy server ID for multi-server deployments (optional)"
    required: false
  MACHINE_TYPE:
    description: "Machine type/size for the workspace"
    default: "small"
    enum:
      - "small"
      - "medium"
      - "large"
  AGENT_PATH:
    description: "The path where to inject the DevPod agent to"
    default: "/opt/devpod/agent"

agent:
  path: ${AGENT_PATH}
  driver: docker
  inactivityTimeout: 10m

binaries:
  DOKPLOY_PROVIDER_BINARY:
    - os: linux
      arch: amd64
      path: https://github.com/NaNomicon/dokploy-devpod-provider/releases/latest/download/dokploy-provider-linux-amd64
      checksum: ""
    - os: linux
      arch: arm64
      path: https://github.com/NaNomicon/dokploy-devpod-provider/releases/latest/download/dokploy-provider-linux-arm64
      checksum: ""
    - os: darwin
      arch: amd64
      path: https://github.com/NaNomicon/dokploy-devpod-provider/releases/latest/download/dokploy-provider-darwin-amd64
      checksum: ""
    - os: darwin
      arch: arm64
      path: https://github.com/NaNomicon/dokploy-devpod-provider/releases/latest/download/dokploy-provider-darwin-arm64
      checksum: ""
    - os: windows
      arch: amd64
      path: https://github.com/NaNomicon/dokploy-devpod-provider/releases/latest/download/dokploy-provider-windows-amd64.exe
      checksum: ""

exec:
  # Initialize the provider (test API connection)
  init: |-
    ${DOKPLOY_PROVIDER_BINARY} init

  # Create a new machine/container in Dokploy
  create: |-
    ${DOKPLOY_PROVIDER_BINARY} create

  # Delete the machine
  delete: |-
    ${DOKPLOY_PROVIDER_BINARY} delete

  # Start a stopped machine
  start: |-
    ${DOKPLOY_PROVIDER_BINARY} start

  # Stop the machine
  stop: |-
    ${DOKPLOY_PROVIDER_BINARY} stop

  # Get machine status
  status: |-
    ${DOKPLOY_PROVIDER_BINARY} status

  # Execute commands via SSH
  command: |-
    ${DOKPLOY_PROVIDER_BINARY} command ${COMMAND}
